/*! exceptionjs version 0.9.6 */
!function(){"use strict";function e(e){var n=/https?:\/\/([^/]+)/i.exec(e);return n?n[1]:""}function n(e,n,r){var t=n,o=r;if(void 0!==t){o=o||{},null===t&&(t="",o={expires:-1});var i="";if(o.expires&&("number"==typeof o.expires||o.expires.toGMTString)){var s=void 0;"number"==typeof o.expires?(s=new Date).setTime(s.getTime()+24*o.expires*60*60*1e3):s=o.expires,i=";expires="+s.toGMTString()}var a=o.path?";path="+o.path:"",u=o.domain?";domain="+o.domain:"",c=o.secure?";secure":"";return document.cookie=[e,"=",encodeURIComponent(t),i,a,u,c].join(""),""}if(document.cookie.length>0){var l=document.cookie.indexOf(e+"=");if(-1!==l){l=l+e.length+1;var f=document.cookie.indexOf(";",l);return-1===f&&(f=document.cookie.length),decodeURIComponent(document.cookie.substring(l,f))}}return""}function r(e){return e.sort(function(e,n){var r=e.message.msg||"",t=n.message.msg||"";return r===t?0:r<t?-1:1}),e.reduce(function(e,n){var r=e[e.length-1];return e.length&&r&&r.message.msg&&r.message.msg===n.message.msg?(r.message.duplicateCount=(parseFloat(r.message.duplicateCount)||0)+1,e):(e.push(n),e)},[])}function t(e){return e.filter(function(e){return!e.message||!e.message.msg||e.message.msg.indexOf("getWebkitEvent")<0})}function o(e){var n=["window.fanliRemoveSmartAd","(evaluating 'v.src')","hookhunantvByTimer","Can't find variable: mraid","/main.js:","window.api.passsharetext","neteaseTracker is not defined","@global code","kl_plugin.js"];return e.filter(function(e){return!e.message||!e.message.msg||!n.some(function(n){return e.message.msg.indexOf(n)>=0})})}function i(e){var n=["Baiduspider","X11; Linux i686","X11; Linux x86_64;","Googlebot","MSIE 6.0","MSIE 7.0"];return e.filter(function(e){return!e.message||!e.message.userAgent||!n.some(function(n){return e.message.userAgent.indexOf(n)>=0})})}function s(e){var n=["/ad/appBanner."];return e.filter(function(e){return!e.message||!e.message.ajaxUrl||!n.some(function(n){return e.message.ajaxUrl.indexOf(n)>=0})})}function a(e){return e.filter(function(e){return!e.message||!e.message.msg||(e.type!==X.INLINE_JS_EXCEPTION||"number"!=typeof e.message.lineno||e.message.lineno>=3)})}function u(e,n){return e.reduce(function(e,n){try{return n(e)}catch(r){return D.logger("Error in purgelist filter:"+n.name,r),e}},n)}function c(e){return u([t,r,o,i,s,a],e)}function l(e,n,r){var t=n||function(){},o=r||function(){},i=void 0;i=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");var s=!!window.XDomainRequest;s?((i=new XDomainRequest).onload=t,i.onerror=o):(i.withCredentials=!0,i.onreadystatechange=function(){4===i.readyState&&200===i.status?t():4===i.readyState&&o()}),i.open(F,M),s||i.setRequestHeader("Content-type","text/plain");try{i.send(e)}catch(a){D.logger("exceptionjs xhr.send error",a)}}function f(e){if(!e||!e.length)return[];var n=e.splice(0,e.length);try{n=c(n)}catch(r){D.logger("exceptionjs purgelist error",r)}return n&&n.length?n:[]}function g(e){var n=e;return"object"==typeof n&&JSON&&JSON.stringify&&(n=JSON.stringify(n)),n}function m(e){G.push(e),q()}function p(){this.listeners=[]}function d(){setTimeout(function(){try{if(!V||!V.length)return;var e=[].concat(V);W.executelisteners(e)}catch(n){D.logger("Error in performance asynConsumeAllEvents",n)}},0)}function E(e,n){return{type:X.KAOLA_NAVIGATION_TIMING,level:n,message:{msg:"navigation too slow@"+e.name,timingEntry:e}}}function v(e,n){return{type:X.KAOLA_RESOURCE_TIMING,level:n,message:{msg:"resource load slow@"+e.name,timingEntry:e}}}function h(e){return e.responseEnd===undefined||e.startTime===undefined?e.duration!==undefined?e.duration:0:e.responseEnd-e.startTime}function y(){return H.performance.getEntriesByType("navigation")[0]}function T(){return H.performance.getEntriesByType("resource")}function O(e){var n=e.map(function(e){var n=h(e),r=D.pick(e,z);return r.networkTime=n,r});n.sort(function(e,n){return e.networkTime-n.networkTime});var r=n.reduce(function(e,n){var r=n.networkTime,t=Math.round(r/1e3*2)/2;return e[""+t]=parseFloat(e[""+t]||0)+1,e},{}),t=Object.keys(r).reduce(function(e,n){return e?r[n]>=r[e]?n:e:n}),o=parseFloat(t);return n.filter(function(e){return e.networkTime>K+1e3*o})}function k(){var e=y();if(!e)return[];var n=T();return n.length?(n.push(e),O(n)):[]}function x(e){e&&e.length&&e.map(function(e){return"resource"===e.entryType?v(e,L.ERROR):E(e,L.ERROR)}).forEach(function(e){V.push(e)})}function _(){setTimeout(function(){try{x(k()),d()}catch(e){D.logger("Error in processPerformanceData",e)}},0)}function w(){setTimeout(function(){try{if(!Y||!Y.list||!Y.list.length)return;var e=Y.list.splice(0,Y.list.length);Z.executelisteners(e)}catch(n){D.logger("Error in asynConsumeAllEvents",n)}},0)}function I(e){ee.forEach(function(n){n(e)})}function N(e){try{D.isArray(e)?e.forEach(function(e){I(e)}):I(e)}catch(n){D.logger("Error in trackindex handler",n)}}function A(e){if(!e||e.indexOf("?")<0)return e;var n=["version","platform","apiVersion","appChannel","deviceUdID","network","width","imgtype","ursId","ursToken","ursAuth"],r=e.split("?")[0],t=e.split("?")[1],o=t.split("#")[0],i=t.split("#")[1],s=D.query2Object(o),a=Object.keys(s).filter(function(e){return!n.some(function(n){return n===e})}),u=D.pick(s,a),c=D.object2Query(u);return r+(c?"?"+c:"")+(i?"#"+i:"")}function b(e){var n=e.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),r=e.toString();return n.indexOf(r)<0&&(n=r+"@"+n),n}function S(e){var n=e.error;try{if(n&&n.stack){var r=n.stack.match("https?://[^\n]+"),t=(r=(r=r?r[0]:"")||e.url||e.filename).match(":(\\d+):(\\d+)");return t||(t=[0,e.lineno||0,e.colno||0]),{msg:b(n),lineno:t[1],colno:t[2],filename:r.replace(t[0],""),_orgMsg:n.toString()}}return n&&n.name&&n.message&&n.description?{msg:n.message+", error name: "+n.name+", description: "+n.description,filename:e.url||e.filename||""}:e.message?{msg:e.message,lineno:e.lineno,colno:e.colno,filename:e.url||e.filename||""}:e}catch(o){return e||{}}}function R(e){e&&"object"==typeof e&&(e.userAgent=oe.navigator.userAgent,e.currentUrl=A(oe.location.href),e.clientTimestamp=Number(new Date),D.isCookieEnabled()||(e.cookieEnabled=!1))}function j(e){if(ie<=0)return"";ie-=1;var n=e.lineno;if(!n||(parseFloat(n)||0)<=0)return"";if(n=parseFloat(n)-1,!document.documentElement)return"";var r=document.documentElement.outerHTML;if(!r)return"";var t=r.split("\n");if(n>t.length)return"";for(var o="",i=0,s=0;o.length<te&&(i<=ne||s<=re);){if(0===i)o=t[n];else{if(i<=ne&&n-i>=0&&(o=t[n-i]+"\n"+o),o.length>te)return o;if(s<=re&&n+i<t.length&&(o=o+"\n"+t[n+i]),o.length>te)return o}i+=1,s+=1}return o}function C(e){var n=void 0;if(oe.ErrorEvent&&e instanceof oe.ErrorEvent){if(n=S(e),D.getErrorType(e)===X.INLINE_JS_EXCEPTION)try{n.inlineDocumentHtml=j(n)}catch(r){D.logger("Error in getDocumentHtml:",r)}}else n=e;return R(n),n}var L={INFO:3,WARN:2,ERROR:1,FATAL:0},X={UNKNOW_JS_EXCEPTION:"unknownJsException",KAOLA_JS_EXCEPTION:"kaolaJsException",EXTERNAL_JS_EXCEPTION:"externalJsException",INLINE_JS_EXCEPTION:"inlineJsException",KAOLA_RESOURCE_TIMING:"kaolaResourceTiming",KAOLA_NAVIGATION_TIMING:"kaolaNavigationTiming"},J=["126.net","kaola.com","127.net"],M="//log-collector.kaola.com/api/weblog",P=window,U=function(){var e=void 0;return function(r,t){if(t&&(e=undefined),e!==undefined)return e;if(r!==undefined)return e=r;n("__testcookie__","1",{expires:30});var o=n("__testcookie__");return e="1"===o,n("__testcookie__",null),e}}(),D={getDomain:e,getErrorType:function(n){var r=void 0,t=void 0;return P.ErrorEvent&&n instanceof P.ErrorEvent||n.ie8?(r=n.ie8?n.url:n.filename,t=e(r),r===P.location.href?X.INLINE_JS_EXCEPTION:function(e){return J.some(function(n){return e.indexOf(n)>=0})}(t)?X.KAOLA_JS_EXCEPTION:X.EXTERNAL_JS_EXCEPTION):X.UNKNOW_JS_EXCEPTION},getErrorLevelByErrorObj:function(e){return e&&e.message&&(e.message.error&&e.message.error.name&&"imgloaderror"===e.message.error.name||e.message.message.indexOf("imgloaderror")>=0)?L.INFO:L.ERROR},logger:function(e,n){window.console&&window.console.log&&(console.group&&console.groupEnd&&console.group("%cError in exceptionjs","color:#F00;font-size:13px;"),console.log(e),n&&console.log(n),console.groupEnd&&console.groupEnd())},isCookieEnabled:function(){return U(navigator.cookieEnabled)},isCookieEnabledCheck:U,cookie:n,isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},pick:function(e,n){var r={};if("string"==typeof n)return n in e&&(r[n]=e[n]),r;for(var t=n.length,o=-1;++o<t;){var i=n[o];i in e&&(r[i]=e[i])}return r},query2Object:function(e){if(!e)return{};var n=e.replace(/^\?/,"");if(!(n=n.split("#")[0]))return{};var r={};return n.split("&").forEach(function(e){var n=e.split("=");try{r[n[0]]=n[1]?decodeURIComponent(n[1]):""}catch(t){r[n[0]]=n[1]}}),r},object2Query:function(e){if(!e)return"";var n=[];return Object.keys(e).forEach(function(r){n.push(r+"="+(e[r]?encodeURIComponent(e[r]):""))}),n.join("&")}},F="post",G=[],q=function(e,n,r){var t,o,i,s=null,a=0;r||(r={});var u=function(){a=!1===r.leading?0:+new Date,s=null,i=e.apply(t,o),s||(t=o=null)};return function(){var c=+new Date;a||!1!==r.leading||(a=c);var l=n-(c-a);return t=this,o=arguments,l<=0||l>n?(clearTimeout(s),s=null,a=c,i=e.apply(t,o),s||(t=o=null)):s||!1===r.trailing||(s=setTimeout(u,l)),i}}(function(){var e=f(G);if(e&&e.length)try{l(g(e))}catch(n){D.logger("exceptionjs send error",n)}},2e3,{leading:!1}),B=p.prototype;B.listen=function(e){return this.listeners.push(e),function(){this.listeners.indexOf(e)>=0&&this.listeners.splice(this.listeners.indexOf(e),1)}},B.executelisteners=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];this.listeners.forEach(function(e){try{e.apply(undefined,n)}catch(r){D.logger("error when running listener",r)}})};var K=8e3,H=window,W=new p,V=[],Q={listen:function(e){return d(),W.listen(e)}},z=["connectEnd","connectStart","domainLookupEnd","domainLookupStart","duration","entryType","fetchStart","initiatorType","name","requestStart","responseEnd","responseStart","secureConnectionStart","startTime"];H.performance&&H.performance.getEntries&&H.performance.getEntriesByType&&("complete"!==document.readyState?H.addEventListener("load",_):_());var Y=window._ej,Z=new p;Y||D.logger("Error in ErrorTracker, _ej should be defined in html head");var $={listen:function(e){return w(),Z.listen(e)}};Y.onPush=function(){w()};var ee=[];Q.listen(N),$.listen(N);var ne=15,re=5,te=1e3,oe=window,ie=5,se=window;try{!function(e){ee.push(e)}(function(e){var n=C(e.message),r=e.level,t=e.type;(se.ErrorEvent&&e.message instanceof se.ErrorEvent||1===e.message.ie8)&&(r=D.getErrorLevelByErrorObj(e),t=D.getErrorType(e.message)),m({level:r,type:t,message:n})})}catch(ae){D.logger("exceptionjs js error",ae)}}();
